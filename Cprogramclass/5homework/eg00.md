# 第6章 指针 and 引用

C语言中， **指针** 对描述 数据实体之间的关系 的作用至关重要  
指针 的内部实现就是 程序对象 在计算机内存中的 **存储地址**  
是否可以充分利用 指针 编写程序对能否充分发挥计算机性能十分重要  

C语言中，给予了指针一定的计算能力，使其可以顺序变化地指向 数组的各个元素  
并且可以为函数设置 **指针类型的形参** 和 *函数指针形参(?)*  

传统高级语言中， **引用** 是函数的 形参 and 实参 结合的方式之一  
C++则是将引用看作数据对象的一种标志，不仅可用于说明 形参 and 实参 的结合方式，还可用于标志数据对象  

## 6.1 指针的基本概念

指针的主要作用：  

1. 间接引用所指对象  
2. 描述数据之间关系，在数据结构上应用很重要  
3. 利用指针形参，允许函数间接引用调用环境中的变量  
4. 指针 and 数组 结合，更灵活的访问数组元素  

### 1. 变量 变量的地址 and 变量的值

变量定义-\>变量的 类型 and 标识符  
变量的类型 供编译系统参考，以确定其所需内存块字节数量 and 值的表示形式 and 检查变量操作的合法性 and 翻译合法操作为计算机指令  
变量名 供程序引用变量的 **值** or **地址**  
变量值和地址：变量在内存中占据若干子节组成的一个内存储块，存放变量的值，其开始地址即变量地址  
如下例  

```c
int x = 1 ;
x = x + 2 ;
```

```x = x + 2 ;```语句中  
左边的x 表示值的存储位置  
右边的x 表示引用 变量x的值  
拆分一下就是：取x值，加上2，将结果存入x  

### 2. 指针变量 and 其所指向的变量

C语言中  
取地址运算：通过取地址运算符'\&'获取变量地址  
变量的地址：本身也是一种数据，可进行 存储 and 运算  
指针变量：存储程序对象地址值的变量  
指针变量的种类：针对不同的数据类型，指针变量也有不同的类型  

定义的一般形式  
```类型 *标识符;```  
标识符是 指针变量 的名称，指针变量的类型是"类型\*"  
例如  

```c
int *ip ;
float *fp ;
```

其中定义了两个指针变量 ip and fp ，其中 ip 的类型是 "int\*"， fp 的类型是 "float\*"  
指针变量可以存储对应类型的变量的地址  

```c
int i = 2 ;
ip = &i ;
```

上述代码段实现了将整形变量i的地址存入指针变量ip  
类似其他类型，指针变量定义时也可进行赋值初始化  

另外，由于局部变量的性质，未初始化很容易意想不到的奇怪情况，指针变量也是同理  
为明确表示指针变量不指向任何变量，用0(记为NULL)表示此情况，习惯上称此时的指针变量为 空指针  

*个人疑惑点：*既然认为指针变量类型为"类型\*"，为什么不直接让"\*"和"类型"紧贴？
*解释：*```int i , j , *p ;```语句是允许的！

对于初学者的易错点：  

1. 直接给指针变量赋整数值  
2. 为指针变量赋值时没有给对应变量加取地址符号\&  
3. 给指针变量赋不匹配的类型的变量的地址值 或者 将不同类型的指针变量相互赋值  

### 3. 引用指针变量所致的变量

上述段主要实现了 变量-\>地址-\>指针 的过程  
下文则开始讲 指针-\>地址-\>变量 的过程  

程序中引用变量方法：

1. 变量名  
2. 变量的地址  

例子  

```c
ip = &i ;
intpt = &j ;
*intpt = *ip + 5 ;
```

与代码

```c
j = i + 5 ;
```

效果等价  
其中"\*"就是间接引用运算符(也称解引用运算符)  
在printf中可以用"\%d"引用指针的值，就是其所存的地址值，以十六进制形式输出  
可见eg01.c的实例  

指针变量的最主要的应用：  

1. 指针指向数组元素，方便注意改变指针指向，以遍历数组  
2. 为函数设置指针形参，实现在函数住通过指针形参间接调用环境中的变量，实现 引用 or 改变  

注意点：  

1. 区分 定义指针变量 and 间接引用指针变量所指对象 时采用的 '\*'  
2. 通过变量名直接引用 与 通过指针间接引用 基本一致  
3. 然后是大家都最喜欢的 自增自减问题，随着指针的引入变得更加复杂！  
    找不同环节：  
    有定义```int i , j , *ip = &i;```  
    以下有三个运算  
    ```j = ++*ip ;```  
    ```j = *ip++ ;```  
    ```j = (*ip)++ ;```  
    第一个，等价于 先用ip取出i，再对i ++，再将i的值传给j  
    第二个，等价于 先用ip取出i，传入j，再让ip ++(常见于ip指向数组元素的情况，代表指向数组中的下一个元素)  
    第三个，等价于 先用ip去除i，传入j，再让i ++  
    评价是没事别瞎倒腾这些玩意  

## 6.2 指向数组元素的指针

### 1. 数组名 and 指针变量

首先有以下实例定义  
```int a[ 100 ] , *p ;```  
C语言规定，一维数组名表达式是数组首元素的指针  
也就是说```p = &a[ 0 ]```等价于```p = a```，都是使p指向a数组的首个元素a[ 0 ]  

C语言还定义了指向数组元素的指针的运算：  
*以下以实例说明*  

```c
int *p , *q , a[ 100 ] ;
p = &a[ 10 ] ;
q = &a[ 50 ] ;
```

在上述基础下可进行以下计算：  

1. 两个指向同一个数组的元素的指针可以进行比较运算  
    如上进行```p<q```的运算，结果为真  
2. 指向数组元素的指针可以与 整数 进行 加减 运算，实现指针在数组元素之间的移动  
    例如```p ++```可使`p`指向`a[ 11 ]`  

    注意点：C语言规定，指针变量指向数组`a[]`的元素时，不论数组元素类型，指针加减k的运算所对应的`p`的具体变化的字节数为 k乘以`size of a[0]` ，保证移动的对应的 **元素个数** 为k个  

    此外的应用：  与间接引用符号'\*'搭配使用  
    例如```*(p + i)```就表示元素```a[ 10 + i ]```，```*(a + i)```就表示```a[ i ]```  
    并且，上述前者可写成```p[ i ]```  
3. 当两个指针指向同一个数组的某两个元素时，允许两个指针做 减法 运算，结果绝对值等于两个指针所指数组元素之间相差的元素个数  
    上述例子```q-p```的值为40  

引用数组元素方法的总结，3种：  

1. 数组名\[下标\]  
2. *(一维数组名表达式 + i )  
3. 利用指向数组元素的指针变量 搭配上述1or2  

注意点：指向数组首元素的指针变量 and 数组名 的异同  
同：存储的地址都是数组首元素的地址  
异：指针变量可以通过上述提及的运算2进行移动 but 数组名只能指向数组首字母，相当于常量  

指针在字符串中的应用  
因为字符串是存储在字符数组之中的，且其拥有一个性质就是在末尾有字符串结束符，故可以不用指定长度  
由上引出存储字符串常量的两种方式：

1. 存放在字符数组之中  
    ```char s[] = "I am a string."```  
    *注意：除了能算出来的14个字符以外，还有字符串末尾必带的'\\0'，故上述数组大小为15个元素*  
2. 存放字符串的第一个字符的地址于指针变量中  

    ```c
    char *cp1 , *cp2 = "I am a string." ;
    *cp1 = "Another string";
    ```

    上述第一行中 用字符串常量初始化字符指针变量  
    第二行中 用字符串常量赋值给字符指针变量  
    注意：字符串常量 存放在程序运行环境的 常量存储区 中  
    而赋值给字符指针变量的是该 字符常量 的 第一个字符的地址  
    此处不允许通过指针修改常量区的字符串常量  
    输出可以配合printf()函数 搭配 "\%s" ，对应 字符串的首地址，就可以实现输出整个字符串  

## 6.3 指针形参

C语言中，函数调用，会先为形参分配空间，再将实参的值传入函数，以初始化形参，此时修改形参不会改变实参  
此时 指针形参 则可以实现这种效果  
C语言规定，可以在函数形参表中，定义各种类型的指针变量  
例如```void divNum ( int *intPt , int d ) ;```  
以上函数声明中```intPt```就是一个指针形参，可以指向int类型的变量  
这样，通过将指向某变量的指针实参传入函数，函数就可以通过该指针类型形参调用环境中的变量  

简单来说，要实现函数能按需要改变有实参指定的变量时  
需要：  

1. 函数设置指针形参  
2. 函数体通过指针形参间接引用变量  
3. 调用函数是，以希望改变的变量的指针(或者说它的地址)为实参  

## 6.4 数组形参

为使函数可以处理不同的数组，函数可以设置 **数组形参**  
对应实参是数组某元素的地址，一般来说是首元素(且由于数组名可代表数组首元素的地址，常直接用数组名填充实参)  

1. 一维数组形参设置的一般形式：  
    ```int sum ( int a[] , int n )```  
    即指定数组的变量类型，不用指定元素的个数(因为实际上传入的就是一个常量指针变量，且没有要求一定是数组首元素)  
    而元素的个数一般会在形参中另外设置一个整形形参用以代表数组的大小(或者是实际用到的数组范围)  
    *另外值得一提的是，虽然形参形式上是个数组，但是其本质上并不相同，此处它是可以改变的(与一般的数组名等同于常量指针形成差异)*  

    调用：  

    ```c
    int x[] = { 1 , 2 , 3 , 4, 5 } ;
    int i , j ;
    i = sum( x , 5 ) ;
    j = sum( &x[ 2 ] , 3 ) ;
    ```

    以上对应上述函数(定义省略)的调用，
    直观来说，调用了整个x数组为i赋值，调用了一部分的x数组为j赋值  

2. 二维数组形参设置形式：  
    最高维数可以和定义一维数组一样省略个数，但是**第一维必须指定个数**！  
    (可以结合数组的存储方式来理解，多维数组顺序存储线性表，若不指定除最高维以外的大小，下标调用的方式就无从知道对应元素的具体地址)  

数组形参 and 指针形参 的关系：  
数组形参 实际上就是一种 指针形参 ，  
但是其指定了实参必须是 数组某元素 的指针，而不能是一般的变量  

## 6.5 指向二维数组一整行的指针

程序可以定义指向 二维数组一整行 的指针变量  
与指向数组某元素的指针的差别在于，这种指针增减一个单位，会向前或向后移动一整行  

1. 定义形式：  
    ```int (*p)[ 10 ] ;```  
    就实现了 指向一个由10个int型元素 组成的 数组  
    注意："()"是必须添加的(否则就变成了6.6中的指针数组)  

2. 应用方式：  
    以下结合实例进行说明  
    实例：  

    ```c
    int a[ 3 ][ 4 ] = { {1,2,3,4} , {5,6,7,8} , {9,10,11,12} } ;
    int (*p)[ 4 ] ;
    p = a ;
    ```

    以上代码段就实现了定义一个 $3\times4$ 的int型二维数组a，  
    以及一个指向 由4个int型元素 组成的数组的 指针p，  
    并且，将a第一行的一维数组a\[ 0 \]的首地址赋值给了p  

    **注意：**虽然类似于一维数组的，也有```a , a+i , a[ i ]```的表示但意义上有点不同  
    ```*(a + i)```是等价于```a[ i ]```的，也就是说```a + i```是指向```a```数组中第i行( $0\le i \le n-1$ )的一维数组的指针，对其解引用之后得到的是指向 这个一维数组的首元素 的指针 *(可以理解为一维数组的数组名)*  
    在这种背景下，指向 二维数组一整行的指针 的定位与上述中的```a + i```是类似的  

    具体结合上述例子来说就是：  
    ```a[ i ][ j ]```可以等价于  

   1) ```*(a[ i ] + j)```or```*(p[ i ] + j)```  
   2) ```*(*(a + i) + j)```or```*(*(p + i) + j)```  
   3) ```(*(a + i))[ j ]```or```(*(p + i))[ j ]```  
